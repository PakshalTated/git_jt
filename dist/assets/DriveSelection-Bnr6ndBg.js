import{G as ye,u as Q,r as s,a as Y,e as z,l as ee,j as t,i as f,D as E,t as ke}from"./index-b9OYvAdP.js";import{F as ve,s as we}from"./index-9bYYq6UN.js";import{h as W,v as Le}from"./Dashboard-DSqmdOgz.js";import{L as Ce,b as je}from"./index-DHI5Vo0j.js";import{O as Se}from"./AnnotationLayer-CsQ9Me8w.js";function Ne(a){return ye({tag:"svg",attr:{viewBox:"0 0 32 32"},child:[{tag:"path",attr:{d:"M 11.4375 5 L 11.15625 5.46875 L 3.15625 18.46875 L 2.84375 18.96875 L 3.125 19.5 L 7.125 26.5 L 7.40625 27 L 24.59375 27 L 24.875 26.5 L 28.875 19.5 L 29.15625 18.96875 L 28.84375 18.46875 L 20.84375 5.46875 L 20.5625 5 Z M 13.78125 7 L 19.4375 7 L 26.21875 18 L 20.5625 18 Z M 12 7.90625 L 14.96875 12.75 L 8.03125 24.03125 L 5.15625 19 Z M 16.15625 14.65625 L 18.21875 18 L 14.09375 18 Z M 12.875 20 L 26.28125 20 L 23.40625 25 L 9.78125 25 Z"},child:[]}]})(a)}const De=a=>{const d=["jpg","jpeg","png","doc","docx","pdf","ppt","pptx","mp4","txt","xls","xlsx","mov"],m=a.name.split(".").pop().toLowerCase();return d.includes(m)},Ue=(a,d)=>a.size<=d,Ie=(a,d=70)=>{const l=a.split(".").pop(),m=a.substring(0,a.lastIndexOf("."));return m.length>d?`${m.slice(0,d)}.${l}`:a};function Fe({fileUpload:a,setDriveSelection:d,setContentPlaceHolders:l,setContentPlaceHolderModal:m}){var D;const k=Q(),{viewer_id:v,baseURL:u,directContentUpload:C,setDirectContentUpload:c,setDirectContent:Z}=s.useContext(Y),p=z(i=>i.contents.breadcrumbs),j=((D=p[p.length-1])==null?void 0:D.id)||null,[R,O]=s.useState(""),K=ee(),[h,S]=s.useState("");s.useEffect(()=>{O(p)},[]),s.useEffect(()=>{S(p)},[p]);const T=async(i,b,g)=>(i.append("created_by",b),i.append("description","Content"),C?i.append("direct_pitch_content",1):i.append("folder",g),d(!1),K.post("/local-upload",i,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0})),N=400*1024*1024,w=async i=>{var I;const g=Array.from(i.target.files).filter(De);if(g.length===0){f.error("No supported files were selected.");return}const P=new FormData;g.length>1?f.loading(`Uploading ${g.length} files...`):f.loading(`Uploading ${g[0].name}...`);for(const o of g)if(Ue(o,N)){const F=Ie(o.name),L=new File([o],F,{type:o.type});P.append("files",L)}else f.error(`${o.name} file too large!`);try{const o=await T(P,v,j);if(o.data){const L=o.data.uploadedFiles.filter(_=>_.placeholders.length>0);L.length>0&&(m(!0),l(L))}k(E({viewer_id:v,folder_id:j,baseURL:u}))}catch(o){console.error("File upload error:",o),f.error("An error occurred during file upload.")}f.dismiss(),f.success(`Successfully uploaded ${g.length} files.`);const U=(I=p[p.length-1])==null?void 0:I.id;!C&&j===U&&R!==h&&k(E({viewer_id:v,folder_id:U,baseURL:u}))};return t.jsx("div",{children:t.jsx("input",{type:"file",ref:a,accept:".jpg,.jpeg,.png,.doc,.docx,.pdf,.ppt,.pptx,.mp4,.xls,.xlsx,.mov",style:{display:"none"},multiple:!0,onChange:w})})}const _e="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.readonly",Ae=[{name:"One Drive",icon:Le},{name:"Google Drive",icon:Ne},{name:"Local Drive",icon:je},{name:"Public Link",icon:Se}];function Ze({setContentPlaceHolders:a,setContentPlaceHolderModal:d}){const[l,m]=s.useState(""),k=z(e=>e.contents.breadcrumbs),v=Q(),{setDriveSelection:u,baseURL:C,viewer_id:c,frontendBaseURL:Z,folder_id:p,setOneDrivePickerOpen:j,selectedOrganisationId:R,directContentUpload:O,setDirectContentUpload:K}=s.useContext(Y),h=ee(),[S,T]=ke(["OneDriveAccessToken","GoogleDirveAccessToken"]),N=s.useRef(),w=z(e=>e.contents.breadcrumbs),[D,i]=s.useState(""),[b,g]=s.useState(""),[P,U]=s.useState(null),[I,o]=s.useState(!1),[F,L]=s.useState(!1),[_,te]=s.useState(""),[Ee,se]=s.useState([]),[Re,re]=s.useState(!1);s.useState(!1);const[Oe,V]=s.useState(!0),[ae,X]=s.useState(!1),[ne,A]=s.useState(!1),[G,q]=s.useState(""),[B,H]=s.useState(""),[M,J]=s.useState(""),oe=e=>{try{const r=new URL(e);return`${r.protocol}//${r.hostname}`}catch(r){return console.error("Invalid URL",r),null}};s.useEffect(()=>{h.post("/google-credentials",{viewer_id:c}).then(e=>{e.data.message==="Google credentials generated successfully"&&(i(e.data.googleApiKey),g(e.data.googleClientId))}).catch(e=>{console.error("Failed to fetch namespace",e)})},[c]),s.useEffect(()=>{h.post("/view-authorised-namespace",{viewer_id:c,organisation_id:R}).then(e=>{e.data.data.length===1?te(e.data.data[0].namespace):se(e.data.data)}).catch(e=>{console.error("Failed to fetch namespace",e)})},[c]),s.useEffect(()=>{l=="One Drive"?(console.log(l),localStorage.setItem("source_sync",1)):localStorage.removeItem("source_sync")},[l]);const le=()=>{localStorage.setItem("source_sync",0)},ce=()=>{localStorage.setItem("source_sync",1)},ie=async()=>{if(localStorage.setItem("versionUpload",0),S.OneDriveAccessToken)j(!0);else if(_)try{const n=(await h.get("/onedrive-auth",{params:{nameSpace:_,subdomainURL:Z,folderPath:w,viewer_id:c}})).data;window.location.href=n}catch(r){console.error("Error starting OneDrive authentication:",r)}else re(!0)};s.useEffect(()=>{if(b){const e=()=>{window.gapi.load("picker",r)},r=()=>{o(!0)},n=()=>{const $=window.google.accounts.oauth2.initTokenClient({client_id:b,scope:_e,callback:""});U($),L(!0)};window.gapi_onload=e;const x=document.createElement("script");x.src="https://apis.google.com/js/api.js?onload=gapi_onload",document.body.appendChild(x);const y=document.createElement("script");y.src="https://accounts.google.com/gsi/client",y.async=!0,y.defer=!0,y.onload=n,document.body.appendChild(y)}},[b]);const de=e=>{if(u(!1),I&&F&&e){const r=new window.google.picker.DocsView(window.google.picker.ViewId.DOCS).setIncludeFolders(!0).setSelectFolderEnabled(!0);new window.google.picker.PickerBuilder().enableFeature(window.google.picker.Feature.MULTISELECT_ENABLED).setOAuthToken(e).addView(r).setDeveloperKey(D).setCallback(x=>ue(x,e)).build().setVisible(!0)}},ue=async(e,r)=>{if(e.action===window.google.picker.Action.PICKED){const n=e.docs[0].id;u(!1),f.promise(h.post("/googledrive-upload",{fileID:n,created_by:c,accessToken:r,folder_id:p}),{loading:"Uploading file...",success:"Content Added Successfully!",error:"Failed to Add Content"}).then(()=>v(E({viewer_id:c,folder_id:k[k.length-1].id,baseURL:C}))).catch(x=>{console.error("Google Drive upload error:",x)})}},pe=async()=>{console.log("FOLDER ID here",p);const e=S.GoogleDirveAccessToken,r=await h.post("/google-credentials",{viewer_id:c});if(!e&&r.data.message==="Google credentials generated successfully"){const{googleClientId:n,googleDriveRedirectUrl:x}=r.data;T("googleClientId",n,{path:"/",domain:".revspire.net",secure:!0,sameSite:"Lax"});const y=window.location.href,$=oe(y),xe=encodeURIComponent(JSON.stringify(w)),be=`${x}?redirectDomain=${encodeURIComponent($)}&breadcrumbState=${xe}`;window.location.href=be}else b&&de(e)},ge=()=>{N.current.click()},me=()=>{A(!0)};W([()=>{u(!1)}]);const fe=()=>{switch(l){case"One Drive":return t.jsx("button",{className:"px-6 py-2 text-sm text-white btn-secondary",onClick:ie,children:"Authorise"});case"Google Drive":return t.jsx("button",{className:"px-6 py-2 text-sm text-white btn-secondary",onClick:pe,children:"Authorise"});case"Local Drive":return t.jsx("button",{className:"px-6 py-2 text-sm text-white btn-secondary",onClick:ge,children:"Browse"});case"Public Link":return t.jsx("button",{className:"px-6 py-2 text-sm text-white btn-secondary ",onClick:me,children:"Next"});default:return null}},he=async()=>{var r;if(!M&&!G&&!B){V(!1);return}X(!0);let e={publicURL:M,url_name:G,description:B,created_by:c};O?e={...e,direct_pitch_content:1}:e={...e,folder_id:((r=w[w.length-1])==null?void 0:r.id)||""};try{const n=await h.post("/publicURL-upload",e,{withCredentials:!0});n&&(console.log(n.data),J(""),q(""),H(""),f.success("Url Upload Successfully"),A(!1),m(""),u(!1),v(E({viewer_id:c,folder_id:e.folder_id,baseURL:C})))}catch(n){console.log(n.message)}finally{V(!1),X(!1)}};return W([()=>{u(!1)}]),ne?t.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-[40]",children:[t.jsx("div",{className:"absolute inset-0 bg-gray-800 dark:bg-gray-900 opacity-50"}),t.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 z-[41] w-full rounded-lg max-w-lg",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex relative items-center justify-center",children:[t.jsx("h3",{className:"text-2xl font-semibold text-center text-neutral-800 dark:text-gray-200",children:"Add Public URL"}),t.jsx("button",{type:"button",className:"absolute right-0 text-gray-400 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-200 rounded-lg text-sm w-8 h-8 inline-flex justify-center items-center",onClick:()=>A(!1),children:t.jsx(ve,{className:"text-neutral-700 dark:text-gray-300 text-2xl",icon:we})})]}),t.jsxs("div",{className:"bg-orange-100 dark:bg-yellow-900 border text-sm p-2 relative rounded-md border-orange-200 dark:border-yellow-700 text-orange-600 dark:text-yellow-300",children:[t.jsx("span",{className:"font-semibold",children:"Warning:"})," Some URLs may not render properly in iframes due to security restrictions set by the website owners. Please ensure the URL allows embedding in iframes for the best experience."]}),t.jsx("div",{className:"space-y-4",children:[{label:"Name",value:G,onChange:q},{label:"Description",value:B,onChange:H},{label:"Public URL",value:M,onChange:J,type:"url"}].map(e=>t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e.label}),t.jsx("input",{type:e.type||"text",value:e.value,onChange:r=>e.onChange(r.target.value),className:"p-2 outline-none bg-neutral-100 dark:bg-gray-700 border border-neutral-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 hover:bg-neutral-100 transition-all rounded-lg placeholder:text-neutral-400 dark:placeholder:text-gray-500 text-neutral-800 dark:text-gray-200 focus:border-blue-500",required:!0})]},e.label))}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("button",{className:"px-6 py-2 text-sm text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors border border-gray-300 dark:border-gray-600",onClick:()=>A(!1),children:"Back"}),t.jsx("button",{className:"px-6 py-2 flex items-center justify-center text-sm text-white btn-secondary dark:bg-blue-600 dark:hover:bg-blue-700 rounded-lg transition-colors w-[96px] h-[38px]",onClick:he,children:ae?t.jsx(Ce,{className:"animate-spin"}):"Submit"})]})]})})]}):t.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-40",children:[t.jsx("div",{className:"absolute inset-0 bg-gray-800 dark:bg-gray-900 opacity-50"}),t.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-md z-10 max-w-lg w-full",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-2xl font-semibold text-center text-neutral-800 dark:text-gray-200",children:"Add Content"}),t.jsx("div",{className:"grid grid-cols-1 gap-4",children:Ae.map(e=>t.jsxs("div",{className:`flex items-center p-4 gap-3 rounded-lg cursor-pointer transition-colors border ${l===e.name?"bg-cyan-100 dark:bg-cyan-900 border-cyan-200 dark:border-cyan-800":"hover:bg-gray-100 dark:hover:bg-gray-700 dark:border-gray-700"}`,onClick:()=>m(e.name),children:[t.jsx(e.icon,{className:"dark:text-cyan-500 text-3xl text-cyan-700"}),t.jsxs("div",{className:"flex justify-between items-center w-full",children:[t.jsx("span",{className:"text-xl dark:text-gray-200",children:e.name}),l===e.name&&e.name==="One Drive"&&t.jsxs("label",{class:"inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",defaultChecked:!0,onChange:r=>r.target.checked?ce():le(),value:"",class:"sr-only peer"}),t.jsx("div",{class:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-[#044a7b] rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),t.jsx("span",{class:"ms-3 text-sm font-medium text-gray-900 dark:text-gray-300"})]})]})]},e.name))}),t.jsxs("div",{className:"flex justify-between mt-6",children:[t.jsx("button",{className:"px-6 py-2 text-sm text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/50 rounded-lg hover:bg-red-200 dark:hover:bg-red-900 transition-colors border border-red-200 dark:border-red-800",onClick:()=>u(!1),children:"Cancel"}),fe()]})]})}),t.jsx(Fe,{fileUpload:N,setDriveSelection:u,setContentPlaceHolders:a,setContentPlaceHolderModal:d})]})}export{Ze as D};
