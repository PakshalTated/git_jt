import{r as l,a as O,l as I,j as e,i as z}from"./index-b9OYvAdP.js";import{Q as U,B as A}from"./ReactToastify-D-1G0H5q.js";import{h as R}from"./Dashboard-DSqmdOgz.js";import{F as B,aj as M}from"./index-9bYYq6UN.js";import"./AnnotationLayer-CsQ9Me8w.js";import"./module-C6tlsdyI.js";import"./index-DHI5Vo0j.js";import"./index-DSB5HKeL.js";import"./RevSpire-logo-BbDjnAdX.js";const P=({isActive:s})=>e.jsx("span",{className:`h-2 w-2 rounded-full ${s?"bg-sky-700":"bg-gray-400"}`}),L=s=>{const g=/[0-9]/.test(s),h=/[!@#$%^&*(),.?":{}|<>]/.test(s),d=/[a-zA-Z]/.test(s);return{minLength:s.length>=8,hasDigit:g,hasSpecialChar:h,hasAlphabet:d}};function T(){const{setResetPasswordDialogOpen:s,user_name:n}=l.useContext(O),[g,h]=l.useState(""),[d,j]=l.useState(""),[p,v]=l.useState(""),[b,o]=l.useState(""),[N,r]=l.useState(""),[u,S]=l.useState({minLength:!1,hasDigit:!1,hasSpecialChar:!1,hasAlphabet:!1}),k=I(),D=c=>{const f=c.target.value;j(f),S(L(f))},C=async c=>{if(c.preventDefault(),d!==p)o("New Password and Confirm Password do not match");else if(d===g)o("New Password cannot be the same as the Current Password");else{const f=L(d);if(Object.values(f).includes(!1))o("New Password does not meet all the criteria.");else{o("");try{const y=await k.post("/change-password",{username:n,currentPassword:g,newPassword:d}),_=await y.data;y.status===200?(A.success("Password changed successfully"),r(_.message),s(!1)):(o(_.message),A.error("Password change failed. Please try again later"))}catch{A.error("An error occurred. Please try again later."),o("An error occurred while changing password. PLease try again later.")}}}},$=R([()=>{s(!1)}]);return e.jsxs("div",{children:[e.jsx(U,{}),e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-800 opacity-50"}),e.jsxs("div",{ref:$,className:"bg-white p-6 rounded-md z-50 w-2/6",children:[e.jsxs("div",{className:"flex flex-row justify-between w-full",children:[e.jsx("div",{}),e.jsx("button",{className:"text-gray-600 hover:text-gray-900",onClick:()=>s(!1),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center px-6 py-8 mx-auto lg:py-0",children:[e.jsx("h2",{className:"mb-1 text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white",children:"Change Password"}),e.jsxs("form",{className:"mt-4 space-y-4 lg:mt-5 md:space-y-5 w-full",onSubmit:C,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"current-password",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Current Password"}),e.jsx("input",{type:"password",name:"current-password",placeholder:"••••••••",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:!0,value:g,onChange:c=>h(c.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"new-password",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"New Password"}),e.jsx("input",{type:"password",name:"new-password",id:"new-password",placeholder:"••••••••",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:!0,value:d,onChange:D})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirm-password",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Confirm Password"}),e.jsx("input",{type:"password",name:"confirm-password",id:"confirm-password",placeholder:"••••••••",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",required:!0,value:p,onChange:c=>v(c.target.value)})]}),e.jsxs("div",{className:"flex space-x-1 mt-2",children:[e.jsx(P,{isActive:u.minLength}),e.jsx(P,{isActive:u.hasDigit}),e.jsx(P,{isActive:u.hasSpecialChar}),e.jsx(P,{isActive:u.hasAlphabet})]}),b&&e.jsx("p",{className:"text-red-500 text-sm",children:b}),N&&e.jsx("p",{className:"text-green-500 text-sm",children:N}),e.jsx("button",{type:"submit",className:"w-full text-white bg-gradient-to-r from-cyan-600 to-cyan-800 mt-2 items-center hover:bg-sky-800 focus:ring-1 focus:outline-none focus:ring-gray-400 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-gray-600 dark:hover:bg-gray-700 dark:focus:ring-gray-800",children:"Change Password"})]})]})]})]})]})}const q=()=>e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:" w-full mt-2 bg-neutral-200 animate-pulse  min-h-[400px] rounded-lg ",children:[e.jsxs("div",{className:"mt-6 ml-10",children:[e.jsx("div",{className:"bg-neutral-300 animate-pulse h-8 w-[150px] rounded-lg"}),e.jsx("div",{className:"bg-neutral-300 animate-pulse h-4 w-[300px] rounded-lg mt-2"})]}),e.jsxs("div",{className:"flex mt-[40px] ml-10 gap-20",children:[e.jsxs("div",{children:[e.jsx("div",{className:"bg-neutral-300 animate-pulse h-4 w-[130px] rounded-lg"}),e.jsx("div",{className:"bg-neutral-300 animate-pulse h-[40px] w-[400px] rounded-md mt-2"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-neutral-300 animate-pulse h-4 w-[130px] rounded-lg"}),e.jsx("div",{className:"bg-neutral-300 animate-pulse h-[40px] w-[400px] rounded-md mt-2"})]})]}),e.jsxs("div",{className:"flex mt-8 ml-10 gap-20",children:[e.jsxs("div",{children:[e.jsx("div",{className:"bg-neutral-300 animate-pulse h-4 w-[130px] rounded-lg"}),e.jsx("div",{className:"bg-neutral-300 animate-pulse h-[40px] w-[400px] rounded-md mt-2"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-neutral-300 animate-pulse h-4 w-[130px] rounded-lg"}),e.jsx("div",{className:"bg-neutral-300 animate-pulse h-[40px] w-[400px] rounded-md mt-2"})]})]}),e.jsxs("div",{className:"flex mt-8 ml-10 gap-20",children:[e.jsxs("div",{children:[e.jsx("div",{className:"bg-neutral-300 animate-pulse h-4 w-[130px] rounded-lg"}),e.jsx("div",{className:"bg-neutral-300 animate-pulse h-[40px] w-[400px] rounded-md mt-2"}),e.jsx("div",{className:"bg-neutral-300 animate-pulse h-[40px] w-[400px] rounded-md mt-2"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-neutral-300 animate-pulse h-4 w-[130px] rounded-lg"}),e.jsx("div",{className:"bg-neutral-300 animate-pulse h-[40px] w-[400px] rounded-md mt-2"})]})]}),e.jsx("div",{className:"flex mt-8 ml-10 gap-20",children:e.jsxs("div",{children:[e.jsx("div",{className:"bg-neutral-300 animate-pulse h-4 w-[130px] rounded-lg"}),e.jsx("div",{className:"bg-neutral-300 animate-pulse h-[40px] w-[400px] rounded-md mt-2"})]})}),e.jsx("div",{className:"flex mt-6 ml-10 gap-20",children:e.jsx("div",{className:"bg-neutral-400 animate-pulse h-[40px] w-[200px] rounded-md"})})]})})}),V=q;function ae(){const[s,n]=l.useState({first_name:"",last_name:"",email:"",username:"",profile:"",organisation:"",timezone_name:"",currency_name:"",job_title:"",calendar_link:""}),[g,h]=l.useState(!0),[d,j]=l.useState(null),p=I(),[v,b]=l.useState(null),[o,N]=l.useState(null),[r,u]=l.useState(!1),[S,k]=l.useState(!1),[D,C]=l.useState(!1),{viewer_id:x,resetPasswordDialogOpen:$,setResetPasswordDialogOpen:c}=l.useContext(O);function f(a){let t="";const m=new Uint8Array(a),i=m.byteLength;for(let w=0;w<i;w++)t+=String.fromCharCode(m[w]);return window.btoa(t)}l.useEffect(()=>{(async()=>{var t;try{const i=(await p.post(`/view-user/${x}`,{viewer_id:x})).data.user;if(n(i),((t=i.profile_photo)==null?void 0:t.type)==="Buffer"){const w=f(i.profile_photo.data);b(`data:image/png;base64,${w}`)}else b(i.profile_photo)}catch(m){j(m.message)}finally{h(!1)}})()},[x]);const y=async a=>{const t=a.target.files[0];if(!t)return;if(t.size>1*1024*1024){z.error("Image size exceeds 1 MB, please choose a smaller image.");return}const m=new FormData;m.append("profile_photo",t),m.append("viewer_id",x);try{await p.post("/update-profile-photo",m,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}});const i=new FileReader;i.onloadend=()=>{b(i.result)},i.readAsDataURL(t)}catch(i){console.error("Error updating profile picture:",i.message)}},_=async()=>{try{const a=x,t=await p.post(`/view-user/${a}`,{viewer_id:a},{withCredentials:!0});n(t.data.user),b(t.data.user.profile_photo)}catch(a){j(a.message)}},F=((s==null?void 0:s.assigned_products)||[]).map(a=>a.product_id),E=async()=>{k(!0),C(!0);try{const a=await p.put(`/edit-user/${x}`,{...s,updated_by:x,products:F});if(a.status>=200&&a.status<300)console.log("User Edited Successfully!"),_("handleSubmitData",E),console.log(),u(!1);else throw new Error("Failed to submit data")}catch(a){console.error("Error submitting data:",a)}finally{h(!1),k(!1),C(!1)}};return g?e.jsx("div",{children:e.jsx(V,{})}):d?e.jsxs("div",{children:["Error: ",d]}):e.jsxs("div",{className:"container rounded-lg max-h-screen flex flex-col border-spacing-16 pl-4 pr-10 pt-6",children:[$&&e.jsx(T,{}),e.jsxs("div",{className:"overflow-x-auto rounded-lg h-full",children:[e.jsx("div",{className:"inline-block bg-white min-w-full align-middle pt-4 pl-4 ",children:e.jsxs("div",{className:" sm:rounded-lg",children:[e.jsx("h3",{className:"mb-0.5 text-xl font-bold dark:text-white",children:"User Details"}),e.jsx("h4",{className:"mb-6 text-sm font-semibold text-gray-500",children:"Review and Update Your Personal Details Here"})]})}),e.jsx("br",{}),e.jsx("div",{className:"inline-block bg-white min-w-full align-middle mt-4 pt-2 pl-4 rounded-lg",children:e.jsxs("div",{className:" sm:rounded-lg ",children:[e.jsx("div",{className:"mt-2 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between space-x-10",children:[e.jsxs("div",{className:"flex flex-row",children:[v?e.jsx("div",{className:"relative inline-flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:v,alt:"Profile",className:"w-20 h-20 ml-6 rounded-full object-cover border border-gray-300"})}):e.jsx("div",{className:"ml-6 w-20 h-20 relative inline-flex items-center justify-center overflow-hidden bg-sky-800 rounded-full dark:bg-gray-600",children:e.jsx("span",{className:"font-semibold text-white text-3xl dark:text-gray-300",children:`${s.first_name[0]}${s.last_name[0]}`})}),e.jsxs("button",{type:"button",className:"ml-10 my-5 text-sky-700 bg-white border border-black hover:bg-gray-100 focus:outline-none font-medium rounded-lg text-sm px-4 py-0 text-center inline-flex items-center",onClick:()=>o&&o.click(),children:[e.jsx(B,{icon:M,className:"mr-2"}),"Upload"]}),e.jsx("input",{type:"file",accept:"image/jpeg, image/png, image/jpg, image/svg+xml",style:{display:"none"},ref:a=>N(a),onChange:y})]}),e.jsx("div",{className:"flex items-end 2xl:space-x-[770px] xl:space-x-[530px] lg:space-x-[230px] md:space-x-4",children:e.jsx("button",{type:"button",className:" my-4 text-white border mr-6 focus:outline-none bg-gradient-to-r bg-[#014d83] focus:ring-4 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center",onClick:()=>c(!0),children:"Change Password"})})]})}),e.jsx("br",{}),e.jsx("div",{className:"inline-block min-w-full align-middle ",children:e.jsx("div",{className:"sm:rounded-lg",children:e.jsx("div",{className:"bg-gray-50 px-4 py-5 sm:p-6 rounded-lg",children:e.jsxs("form",{children:[e.jsxs("div",{className:"flex flex-wrap -mx-3 mb-6",children:[e.jsxs("div",{className:"w-full md:w-1/2 px-3 mb-6 md:mb-0",children:[e.jsx("label",{className:"block uppercase tracking-wide text-gray-900 text-xs font-bold mb-2",children:"First Name"}),e.jsx("input",{id:"first_name",type:"text",value:s.first_name,readOnly:!r,onChange:a=>n(t=>({...t,first_name:a.target.value})),className:`appearance-none block w-full ${r?"bg-white":"bg-gray-100"} text-gray-900 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none `})]}),e.jsxs("div",{className:"w-full md:w-1/2 px-3 mb-6 md:mb-0",children:[e.jsx("label",{className:"block uppercase tracking-wide text-gray-900 text-xs font-bold mb-2",children:"Last Name"}),e.jsx("input",{id:"last_name",type:"text",value:s.last_name,readOnly:!r,onChange:a=>n(t=>({...t,last_name:a.target.value})),className:`appearance-none block w-full ${r?"bg-white":"bg-gray-100"} text-gray-900 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none`})]}),e.jsxs("div",{className:"w-full md:w-1/2 px-3 mb-6 md:mb-0",children:[e.jsx("label",{className:"block uppercase tracking-wide text-gray-900 text-xs font-bold mb-2",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:s.email,readOnly:!r,onChange:a=>n(t=>({...t,email:a.target.value})),className:`appearance-none block w-full ${r?"bg-white":"bg-gray-100"} text-gray-900 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none`})]}),e.jsxs("div",{className:"w-full md:w-1/2 px-3 mb-6 md:mb-0",children:[e.jsx("label",{className:"block uppercase tracking-wide text-gray-900 text-xs font-bold mb-2",children:"Profile Role"}),e.jsx("input",{id:"profile",type:"text",value:s.profile_name,readOnly:!0,onChange:a=>n(s.profile_name),className:"appearance-none block w-full bg-gray-100 text-gray-900 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none  cursor-not-allowed"})]}),e.jsxs("div",{className:"w-full md:w-1/2 px-3 mb-6 md:mb-0",children:[e.jsx("label",{className:"block uppercase tracking-wide text-gray-900 text-xs font-bold mb-2",children:"Job Title"}),e.jsx("input",{id:"job_title",type:"text",value:s.job_title,readOnly:!r,onChange:a=>n(t=>({...t,job_title:a.target.value})),className:`appearance-none block w-full ${r?"bg-white":"bg-gray-100"} text-gray-900 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none`})]}),e.jsxs("div",{className:"w-full md:w-1/2 px-3 mb-6 md:mb-0",children:[e.jsx("label",{className:"block uppercase tracking-wide text-gray-900 text-xs font-bold mb-2",children:"Calendar Link"}),e.jsx("input",{id:"calendar_link",type:"text",value:s.calendar_link,readOnly:!r,onChange:a=>n(t=>({...t,calendar_link:a.target.value})),className:`appearance-none block w-full ${r?"bg-white":"bg-gray-100"} text-gray-900 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none`})]}),e.jsxs("div",{className:"w-full md:w-1/2 px-3 mb-6 md:mb-0",children:[e.jsx("label",{className:"block uppercase tracking-wide text-gray-900 text-xs font-bold mb-2",children:"Timezone"}),e.jsx("input",{id:"timezone",type:"text",value:s.timezone_name,readOnly:!0,onChange:a=>n(s.timezone_name),className:"appearance-none block w-full bg-gray-100 text-gray-900 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none  cursor-not-allowed"})]}),e.jsxs("div",{className:"w-full md:w-1/2 px-3 mb-6 md:mb-0",children:[e.jsx("label",{className:"block uppercase tracking-wide text-gray-900 text-xs font-bold mb-2",children:"Currency"}),e.jsx("input",{id:"currency",type:"text",value:s.currency_name,readOnly:!r,onChange:a=>n(t=>({...t,currency_name:a.target.value})),className:`appearance-none block w-full ${r?"bg-white":"bg-gray-100"} text-gray-900 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none`})]}),e.jsxs("div",{className:"w-full md:w-1/2 px-3 mb-6 md:mb-0",children:[e.jsx("label",{className:"block uppercase tracking-wide text-gray-900 text-xs font-bold mb-2",children:"Microsoft Clarity Project Id"}),e.jsx("input",{id:"microsoft_clarity_project_id",type:"text",value:s.microsoft_clarity_project_id,readOnly:!r,onChange:a=>n(t=>({...t,microsoft_clarity_project_id:a.target.value})),className:`appearance-none block w-full ${r?"bg-white":"bg-gray-100"} text-gray-900 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none`})]}),e.jsxs("div",{className:"w-full md:w-1/2 px-3 mb-6 md:mb-0",children:[e.jsx("label",{className:"block uppercase tracking-wide text-gray-900 text-xs font-bold mb-2",children:"Products"}),s.assigned_products.map(a=>e.jsx("div",{className:"mb-2",children:e.jsx("input",{type:"text",value:a.name,readOnly:!0,className:"appearance-none block w-full bg-gray-100 text-gray-900 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none  cursor-not-allowed",inputs:!0})},a.id))]})]}),e.jsx("div",{className:"flex justify-end",children:r?e.jsxs(e.Fragment,{children:[e.jsx("button",{disabled:S,type:"button",onClick:E,className:"text-white bg-[#014d83] hover:bg-[#015896] rounded-lg px-8 py-2 ",children:D?e.jsx("div",{className:"flex justify-center items-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-[2.2rem] text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]})}):"Save"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"text-gray-800 bg-red-400 border border-gray-600 rounded-lg px-4 py-2 ml-2 hover:bg-red-300",children:"Cancel"})]}):e.jsx("button",{type:"button",onClick:()=>u(!0),className:"text-white bg-[#014d83] rounded-lg px-8 py-2 hover:bg-[#014d83]",children:"Edit"})}),e.jsx("div",{children:e.jsx("button",{})}),e.jsx("div",{children:e.jsx("button",{})}),e.jsx("div",{children:e.jsx("button",{})})]})})})})]})})]})]})}export{ae as default};
