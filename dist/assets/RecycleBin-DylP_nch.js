import{r as s,a as N,l as E,j as a,i as h}from"./index-b9OYvAdP.js";import{k as L,t as O}from"./Dashboard-DSqmdOgz.js";import{F as T,ai as P}from"./index-9bYYq6UN.js";import"./AnnotationLayer-CsQ9Me8w.js";import"./module-C6tlsdyI.js";import"./ReactToastify-D-1G0H5q.js";import"./index-DHI5Vo0j.js";import"./index-DSB5HKeL.js";import"./RevSpire-logo-BbDjnAdX.js";const X=()=>{const[x,b]=s.useState([]),[H,w]=s.useState(!0),{viewer_id:l,baseURL:_,recycleBin:n,setRecycleBin:M,authURL:i,isMatchingCRMFound:m,isServiceUserConnected:u}=s.useContext(N),p=E(),R=L(),[j,C]=s.useState(!0),[r,d]=s.useState([]),[f,I]=s.useState([]),[D,y]=s.useState(!0),g=async()=>{try{const e=await p.post("/view-recycle-bin",{viewer_id:l});e.data.success?(b(e.data.data),console.log(e.data.data),w(!1)):console.error("Failed to fetch audit logs:",e.data.message),C(!1)}catch(e){console.log(e)}};s.useEffect(()=>{g()},[_,l]);const c=x.map(e=>({...e,"Full Name":e.full_name,"Ip Address":e.ip_address}));console.log("Transformed connections:",c);let S=["id","name","delete_date","updated_by","parent_folder"];c.map(e=>{const o={};return S.forEach(t=>{Object.prototype.hasOwnProperty.call(e,t)&&(t==="created_at"||t==="updated_at"?o[t]=new Date(e[t]).toISOString().split("T")[0]:o[t]=e[t])}),o}),s.useEffect(()=>{I([...n.contents,...n.folders])},[n.contents,n.folders]),f.map(e=>({...e,"Deleted By":e.updated_by_name,"Deleted At":e.updated_at}));const v=async()=>{try{const e=await p.post("/unflag-for-deletion",{ids:r.map(o=>o.id),updated_by:l},{withCredentials:!0});h.success("Restored successfully"),d([]),g()}catch{h.error("An error occurred while restoring the files.")}},F=e=>{if(e===f||e.length===0){d(e);return}if(r.findIndex(t=>t.id===e.id)===-1)d(t=>[...t,e]);else{const t=r.filter(A=>A.id!==e.id);d(t)}},U=["name","delete date","folder","source","Updated By","deleted by"],k=["name","delete_date","folder","source","updated_by","delete_by_name"],B=()=>{y(!!(!i&&m&&u))};return s.useEffect(()=>{B()},[m,u,i]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"",children:[a.jsx("div",{className:"container  flex justify-between mx-auto px-4  pt-4 pb-0 w-full",children:R("Restore Content")=="1"&&a.jsx("div",{className:`flex flex-row mb-1 ${r.length>0?"bg-white dark:bg-gray-600 rounded-md p-0.5 shadow-md w-[60vw]":""}`,children:r.length>0&&D&&a.jsxs("button",{type:"button",className:"text-secondary text-[14px] mt-2 pt-1 pb-1 pl-4 pr-4 mr-2 mb-2 rounded-md ml-3 border-solid hover:bg-gray-200  dark:text-gray-200 dark:hover:bg-gray-700 dark:border-gray-500 ",onClick:v,children:[a.jsx(T,{icon:P,className:"mr-2"}),"Restore"]})})}),a.jsx("div",{className:`container  mx-auto ml-auto pl-4 pr-2 pt-1 ${r.length>0?"mt-[2.75rem] pt-1":"pt-12"}`,children:a.jsx(O,{data:c,loading:j,columnsHeading:U,selectedItems:r,rowKeys:k,OnChangeHandler:F})})]})})};export{X as default};
