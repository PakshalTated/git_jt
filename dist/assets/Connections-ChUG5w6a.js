import{r as a,a as U,l as _,j as e,i as I,a0 as Z,s as G,e as W}from"./index-b9OYvAdP.js";import{F as M,n as Y,o as K,ak as $,al as ee,am as te,aa as se,c as ne}from"./index-9bYYq6UN.js";import{i as ae,k as oe,o as re,h as ce,t as X}from"./Dashboard-DSqmdOgz.js";import{M as ie}from"./AnnotationLayer-CsQ9Me8w.js";import{a as le,$ as V}from"./module-C6tlsdyI.js";import"./react-tooltip.min-_gtmIzAn.js";import{Q as de,B as H}from"./ReactToastify-D-1G0H5q.js";import"./index-DHI5Vo0j.js";import"./index-DSB5HKeL.js";import"./RevSpire-logo-BbDjnAdX.js";function ue({connectionDetails:t,selectedConnections:i,viewer_id:h,onAction:E}){a.useState(!1);const[l,m]=a.useState(!1),[u,o]=a.useState(!1),[j,C]=a.useState(!1),{setConnections:y,setSelectedConnections:R}=a.useContext(U),w=_(),v=()=>{m(!0)},S=()=>{m(!1)},g=async()=>{},x=async()=>{o(!0),C(!0);try{const k=i;for(const N of k)try{(await w.post("/edit-crm-connection",{connection_id:N.id,viewer_id:h,active:1})).status===200?I.success("Connection Activated Successfully"):I.error("Failed to activate connection.")}catch(f){console.error(`Error in POST request for ID: ${N.id}`,f),I.error("An error occurred while activating the connection.")}await g(),R([]),m(!1)}catch(k){console.error("Error activating connections:",k),I.error("An unexpected error occurred.")}finally{C(!1),o(!1)}};return e.jsxs("div",{className:"bg-white dark:bg-gray-600 rounded-md p-0.5 shadow-md w-[60vw]",children:[e.jsxs("button",{type:"button",className:"text-secondary text-[14px] mt-2 pt-1 pb-1 pl-3 pr-3 mr-2 mb-2 ml-2 rounded-md border-solid hover:bg-gray-200 dark:text-gray-200 dark:hover:bg-gray-700 dark:border-gray-500 transition duration-300 ease-in-out",onClick:v,children:[e.jsx(M,{icon:Y,className:"mr-2"}),"Activate"]}),l&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full mx-4",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-3 mr-4",children:e.jsx("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Are you sure?"})]}),e.jsx("p",{className:"mb-8 text-lg text-gray-600",children:"Activating a connection will enable all the objects and ref fields related to it."}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{className:"px-6 py-3 text-base font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",onClick:S,children:"Cancel"}),e.jsx("button",{className:"px-6 py-3 text-base font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",onClick:x,disabled:u,children:j?"Activating...":"Confirm"})]})]})})})]})}function me({connectionDetails:t,selectedConnections:i,viewer_id:h,onAction:E}){a.useState(!1);const[l,m]=a.useState(!1),[u,o]=a.useState(!1),[j,C]=a.useState(!1),{setConnections:y,setSelectedConnections:R}=a.useContext(U),w=_(),v=()=>{m(!0)},S=()=>{m(!1)},g=async()=>{},x=async()=>{o(!0),C(!0);try{const k=i;for(const N of k)try{(await w.post("/edit-crm-connection",{connection_id:N.id,viewer_id:h,active:0})).status===200?I.success("Connection Deactivated Successfully"):I.error("Failed to deactivate connection.")}catch(f){console.error(`Error in POST request for ID: ${N.id}`,f),I.error("An error occurred while deactivating the connection.")}await g(),R([]),m(!1)}catch(k){console.error("Error deactivating connections:",k),I.error("An unexpected error occurred.")}finally{C(!1),o(!1)}};return e.jsxs("div",{className:"bg-white dark:bg-gray-600 rounded-md p-0.5 shadow-md w-[60vw]",children:[e.jsxs("button",{type:"button",className:"text-secondary text-[14px] mt-2 pt-1 pb-1 pl-3 pr-3 mr-2 mb-2 ml-2 rounded-md border-solid hover:bg-gray-200 dark:text-gray-200 dark:hover:bg-gray-700 dark:border-gray-500 transition duration-300 ease-in-out",onClick:v,children:[e.jsx(M,{icon:K,className:"mr-2"}),"Deactivate"]}),l&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full mx-4",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"bg-red-100 rounded-full p-3 mr-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Are you sure?"})]}),e.jsx("p",{className:"mb-8 text-lg text-gray-600",children:"Deactivating a connection will remove all the objects and ref fields related to it."}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{className:"px-6 py-3 text-base font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",onClick:S,children:"Cancel"}),e.jsx("button",{className:"px-6 py-3 text-base font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",onClick:x,disabled:u,children:j?"Deactivating...":"Confirm"})]})]})})})]})}function fe({onClick:t}){return e.jsx(e.Fragment,{children:e.jsx(Z,{to:"/content/settings/connection",children:e.jsxs(ae,{type:"button",className:"btn-secondary  flex items-center gap-1  mt-2  text-white  mr-6 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 ",onClick:t,children:[e.jsx(ie,{className:"text-lg"}),"Add"]})})})}function he({onClick:t}){return e.jsxs("button",{type:"button",className:"bg-white text-sky-800 px-4 py-2 rounded-2xl shadow-md mr-4 hover:bg-sky-800 hover:text-white transition duration-300 ease-in-out",onClick:t,children:[e.jsx(M,{icon:$,className:"mr-2"}),"All Connections"]})}function xe(){const{baseURL:t,viewer_id:i,connectionDetails:h}=a.useContext(U),E=_(),l=async()=>{const m=window.location.href,u=new Promise(async(o,j)=>{try{if(!i||!h||!h.id){console.error("viewer_id and connectionDetails.id are required."),j("Viewer ID and connection details are required.");return}const C=`${t}/salesforce-authorisation`,y=new URL(C);y.searchParams.append("crm_connection_id",h.id),y.searchParams.append("viewer_id",i),y.searchParams.append("originURL",m);const R=y.toString().replace(t,""),w=await E.get(R),v=await w.data;if(!(w.status>=200&&w.status<300))throw new Error("Failed to authorize connection");v&&v.authUrl?(window.location.href=v.authUrl,o("Salesforce data synchronized successfully.")):(console.log("Not a valid JSON response"),o("Salesforce data synchronized successfully."))}catch(C){console.error("Error authorizing connection:",C.message),j("Error authorizing connection: "+C.message)}});I.promise(u,{loading:"Authorizing Salesforce connection...",success:o=>`${o}`,error:o=>`Failed: ${o}`})};return e.jsxs("button",{type:"button",className:"bg-white text-sky-800 px-4 py-2 rounded-2xl shadow-md mr-4 hover:bg-sky-800 hover:text-white transition duration-300 ease-in-out",onClick:l,children:[e.jsx(M,{icon:ee,className:"mr-2"}),"Authorise"]})}function ge({onClick:t}){return e.jsx("div",{children:e.jsxs("button",{type:"button",className:"bg-white text-secondary px-4 py-2 rounded-2xl shadow-md mr-4 hover:bg-sky-800 hover:text-white transition duration-300 ease-in-out",onClick:t,children:[e.jsx(M,{icon:te,className:"mr-2"}),"Make Primary"]})})}function J({onAction:t}){const{selectedConnections:i,setAddConnectionsClicked:h,baseURL:E,viewer_id:l,setStep:m,connectionDetails:u,setRefDetails:o,setConnectionDetails:j,setShowConnectionButtons:C,setObjectDetails:y}=a.useContext(U),[R,w]=a.useState(!1),[v,S]=a.useState(!1),g=_(),x=oe();a.useEffect(()=>{(()=>{if(i.length===0){w(!1),S(!1);return}let P=!0,L=!0;i.forEach(B=>{B.active!==1?P=!1:L=!1}),w(P),S(L)})()},[i]);const k=()=>{m(1),h(!0)},N=async()=>{if(!l||!u||!u.id){console.error("viewer_id and connectionDetails.id are required.");return}try{console.log("id:",l);const f=await g.post("/make-primary",{viewer_id:l,connection_id:u.id}),P=await f.data;f.status>=200&&f.status<300?(console.log(P.message),I.success("Primary Connection Updated Successfully ")):console.error("Error:",P.message)}catch(f){console.error("Error making primary connection:",f)}};return e.jsxs("div",{className:"flex flex-row justify-between",children:[u?e.jsxs("div",{className:"container relative flex flex-row pt-0 pb-4",children:[e.jsx(he,{onClick:()=>{j(null),C(!0),y(null),o(null)}}),x("Edit Connections")=="1"&&e.jsx(xe,{}),u.first_auth_success===1&&!v&&x("Edit Connections")=="1"&&e.jsx(e.Fragment,{children:u.is_primary!==1&&e.jsx(ge,{onClick:N})})]}):e.jsxs("div",{className:"container relative flex justify-between pt-0 pb-3",children:[i.length===0&&x("Add Connections")=="1"&&e.jsx(fe,{onClick:k}),v&&x("Activate/Deactivate Connections")=="1"&&e.jsx(ue,{selectedConnections:i,viewer_id:l,connectionDetails:u,onAction:t}),R&&x("Activate/Deactivate Connections")=="1"&&e.jsx(me,{selectedConnections:i,viewer_id:l,onAction:t,connectionDetails:u})]}),e.jsx("div",{className:"py-2",children:e.jsx(re,{queryTable:"crm_connection"})})]})}const pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACS0lEQVR4nOWZT04UQRSHS1joRmMwwLw3CQ2vamLCxgUH8AKwnCu4I6yIwfCqWHoCE7cuucJsjR5AwhZD4oZEN4SFGoQU0wRou/of1dXV+pLOLDoz+b7q32/S3SXE/zQgeTJc3n0h+joo9QVKPkfiD0tLb0D0U0CnB5+h5LdzyjwR/RTQVwcQfwPJr4QYz4o+CuD1QfoQFW+I3grI9IrEXHSsIBB10bGyQKRFx9oCkRUdGwpEU3S8r0DXRUdPAp0VHb0KdFB0kLxmVw2Jf/sWgZBFX0zMsl01kPqH9ytCLRY9W75nz7cfA+ktlHzkUeBkqPS4FQF3+cyMXTWU+uP9YqT3B2pnvhX4G4Hi8jXqCf296iB5r2WB4vJV7QnkrLqFt+eCCJSVz9kTR9YhhQ8vMIU6cH97PGuBgfQnV9bhFnxXAqbpb0MGvhOBgTKrvuCxgw4c+ITHDgSMT3gMLVA3PmXwGFSgZnyqwGNgAeMbHkMKVI1PHXgMJlAxPnXhMaCAaQMeQwmUxacZPH/BFbPevkBJfBrAf53e2ZoZ7/AOAeMFnvQJkH6t1ObDVsBdAq74VIYnPrXPDPaWu1XwXAFHfKrAA/FPlPr9wsrOYhBwh4CpD8/n9llgYWQoKPj1FMWnDD6KfQN0xKcIHog/DxS/FDEM5sTHCU/6MH3mfSBiGczEJw8eSB9HsReQN7fjk4UHyd/tf3mSmEci1sE0Pnfhpy+4ksQ8FbEPpi+i0s9fIPlddBt5RZOu+h8rMaTdkejbgOSJfffZNYf4l+YSeQFphyOU3x8AAAAASUVORK5CYII=",be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAETklEQVR4nO1YW2hcRRg+zBibarw+FB9KBEtFra2CqCD4IAjWBwUR1EfxQYRa0UqlWkFtqqC1SDG07Ey321YNMddW02ptRHqJSaymhpKiaZNtduc/u2c3yV6y2Uuym19mdo3bzWYvZW/g+eDn3ObyfXO+uWqaCRMmTJgwkQ8WaCQcthEuzlAOOmUQoxwE4eI0YWKrxpyrtZqEzV5PGXxOOUQpB1w2GEQog53absfKf7PWMdc6ysQeysQIZSJEGfgIgyHKYbfGxN3lJ7/XtYpwGMhJPCMIE2c1m3EHZeJLykViecFigXL4TLP8Xlce8jZ7fbHk0yJahOAT2gd4Xcn5p2yDFQob5dBEOPSr/sVhTl4Jg0Fpyzqr84Hi2FugsZhWrEQQLrq0fc61BfEnDN6rNmGavd8EqUU8m19AcqjEGhURpxb96ZwCUj7EGg6/ZplYk0tATfmfZgnCRGcOAcJebYI0v5UWlh2dCIe+Qgsa9c8XXOkn52fwlB7DO1vcpRLStJQ8E1tSs2RBhVwKFCbgtoM6Dk/NldZGHPqvto5Ffz4z0deXwnjkSgQPjc6qZ9vfs3j0SgR7RRQbbPqigG2DAfX+Z4ji2lY3vtg7re5luvvaDPzBEUVHKI5b+v24dySE3faIerf6Gze2Xg7jaVcMt/8WwNf7/Cqf/L6m1Y3HHBFV7sfng1lsBPAfe8vYLZQJV2aiv/zz+HZ/AFcddqnnp45P4s6hIF6YmsNHuj1KwK0HdZyOJvC1Mz48PDqLO4aC2DQUxG/HwvhQl0flk9+2DgTwwU6PEiXfbTrrx4/+CGLPRASfPDaJNx7Q0R6M4/X7k3V/+ueMEifzeiIJvOGAnikgluZ7/dXlfv0rp3w4Fozj+nYDz3nmVAt32SP42FGvEnD7IReKUFwJerjbg40tbkXiiR6v8vxzP01h80gINx6fVAJOZhFwf7uxKGCFNVn3ruEZ1fKyTBl1KWFpIdI77slM8rJAWbhsSUlYipGtJ1tl0Ijhhg5jsRO/MxDAE86ostujRzz4/rkAdoyHlYD1HYa6SmEy7b6LIewcj+CPzqSFeiYiuK7dUN/e/NWPv+hRbLkcxnvaDJVG1v3FhZncfYAycJSyg6XHSquOF32Fj1a08Piw7JPX4995sc8dw819/tLPA9y5oSLLh3prRucriQBoyxj/obdcAspA3qdZ3XdlCthcdWK8IOvEKdc3Ll0/NBsN2eaBmtsPcPFM1vVPahnxQjHLiAoSXyAc2pfYJqsIDu9WT4QYl8sDdebEANQemcGOq0abQpD6ExW1E+HwfWmPWJqNBsLEJjVDy1bhYj7pwZLbI67Oh/aMrtDKjv3emygX3mskO61O6DiE5ZaQMBimDHZpXL9XqySIRbx0Dd5OZB/6qgTCxfZiyBPufEurNRD5J5jw5CFv5D0CqSq+mryZcHhDLUOUGJGQV/lMmHhZnq9Wl6AJEyZMmPg/4B+p8Boxk8q33gAAAABJRU5ErkJggg==";function ye(){const{setConnectionDetails:t,setAddConnectionsClicked:i,viewer_id:h,baseURL:E,step:l,setStep:m}=a.useContext(U),u=_(),[o,j]=a.useState(""),[C,y]=a.useState(""),[R,w]=a.useState(""),[v,S]=a.useState(!1),[g,x]=a.useState({}),[k,N]=a.useState("");a.useEffect(()=>{const d=new URLSearchParams(window.location.search),F={};for(const[s,c]of d.entries())F[s]=c;if(x(F),F.code&&F.state){const s=F.state,c=`/getSalesforceAccessToken?code=${F.code}&state=${F.state}&viewer_id=${h}`;u.get(c).then(async A=>{if(console.log("GET Request Response:",A.data),console.log("Message:",A.data.message),A.data.message==="Access token updated successfully")try{const b=await u.post("/view-crm-connection",{viewer_id:h,connection_id:s});b.data.success?(console.log("CRM Connection details:",b.data.connection),t(b.data.connection),i(!1)):console.error("Failed to retrieve CRM connection:",b.data.message)}catch(b){console.error("Error retrieving CRM connection:",b)}}).catch(A=>{console.error("Error making GET request:",A)})}},[E,k,i,t,h]);const f=()=>{m(2)},P=async()=>{m(3);try{const d="/create-crm-connection",F={viewer_id:h,name:C,crm:o,instance_type:R,is_primary:v?1:0},s=await u.post(d,F);if(console.log("Response",s.data),s.data.message==="Record created in crm_connection table successfully."){const c=s.data.connection[0].id;N(c);const A=window.location.href,n=await(await u.get("/salesforce-authorisation",{params:{crm_connection_id:c,viewer_id:h,originURL:A}})).data;n.authUrl?(console.log("Authorization URL:",n.authUrl),window.location.href=n.authUrl):console.error("Failed to retrieve authorization URL")}else console.error("Failed to create connection:",s.data.message);s.status===200?console.log("Connection created successfully:",s.data.connection):console.error("Failed to create connection:",s.data.message)}catch(d){console.error("Error creating connection:",d)}g.code&&g.state&&(console.log("Code:",g.code),console.log("State:",g.state))},L=d=>{j(d)},q=ce([()=>{i(!1)}]),z=()=>{switch(l){case 1:return e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{name:"Salesforce",logo:be},{name:"Dynamics 365",logo:pe}].map(d=>e.jsxs("button",{onClick:()=>L(d.name),className:`flex items-center p-3 rounded-md border transition-all duration-200 ${o===d.name?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300 hover:bg-gray-50"}`,children:[e.jsx("img",{className:"h-10 w-10 mr-3 object-contain",src:d.logo,alt:d.name}),e.jsx("span",{className:"text-base font-medium text-gray-900",children:d.name})]},d.name))})});case 2:return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"connectionName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Connection Name"}),e.jsx("input",{id:"connectionName",type:"text",className:"w-full border border-gray-300 rounded-md py-2 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow duration-200",onChange:d=>y(d.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Instance Type"}),e.jsx("div",{className:"flex space-x-4",children:["Production","Sandbox"].map(d=>e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"instanceType",value:d,onChange:()=>w(d),className:"form-radio h-4 w-4 text-blue-600 transition duration-150 ease-in-out"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:d})]},d))})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"primary",type:"checkbox",onChange:()=>S(d=>!d),className:"form-checkbox h-4 w-4 text-blue-600 transition duration-150 ease-in-out"}),e.jsx("label",{htmlFor:"primary",className:"ml-2 text-sm text-gray-700",children:"Set as Primary Connection"})]})]});case 3:return e.jsxs("div",{className:"flex flex-col items-center justify-center py-6 space-y-4",children:[e.jsx(le,{visible:!0,width:"80",color:"#3B82F6",ariaLabel:"infinity-spin-loading"}),e.jsx("p",{className:"text-base font-medium text-gray-800",children:o?`Connecting to ${o}...`:"Finalizing connection..."})]});default:return null}};return console.log(v),e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm"}),e.jsxs("div",{ref:q,className:"bg-white rounded-lg shadow-xl max-w-xl w-full mx-4 z-10",children:[e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:l===1?"Choose a CRM to connect":l===2?`Configure ${o} Connection`:"Establishing Connection"}),z()]}),l!==3&&e.jsxs("div",{className:"bg-gray-50 px-5 py-3 flex justify-end space-x-2 rounded-b-lg",children:[e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-150",onClick:()=>i(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-150",onClick:l===1?f:P,children:l===1?"Next":"Create Connection"})]})]})]})}function we(){const{connectionDetails:t}=a.useContext(U),[i,h]=a.useState([]);console.log("connectionDetails",t),a.useEffect(()=>{h(t?[t]:[])},[t]),console.log("Original connections:",t);const E=i.map(o=>({...o,"Created At":o.created_at||"N/A","Created By":o.created_by||"N/A","Updated By":o.updated_by||"N/A","Updated At":o.updated_at||"NA","Is Primary":o.is_primary}));console.log("Transformed Users:",E);const l=["name","crm","owner","created By","Created At","Updated By","Updated At","active","Is Primary"],m=["name","crm","owner_name","created_by_name","created_at","updated_by_name","updated_at","active","is_primary"];return console.log("[connectionDetails]",[t]),console.log("columnsHeading",l),console.log("rowData",m),e.jsx("div",{children:e.jsx(X,{data:[t],columnsHeading:l,rowKeys:m,noCheckbox:!0})})}function ve(){const{refDetails:t,setRefDetails:i,connectionDetails:h,setFieldDetails:E,fieldDetails:l,viewer_id:m,selectedFieldId:u}=a.useContext(U),[o,j]=a.useState(null),[C,y]=a.useState(l),[R,w]=a.useState(!0),[v,S]=a.useState(null),[g,x]=a.useState(!1),k=_(),[N,f]=a.useState({name:""}),[P,L]=a.useState(""),B=async()=>{if(m&&u)try{const n=await k.post("/view-fieldsplusreffields",{viewer_id:m,salesforce_object:u});n.data.success?(H.success("Record Inserted Successfully"),i(n.data.data),console.log("table data: ",n.data.data)):console.error("Failed to retrieve CRM object details:",n.data.message)}catch(n){console.error("Error retrieving CRM object details:",n)}x(!1)};a.useEffect(()=>{y(t)},[t]);const q=async n=>{x(!0),L(n.id);const p=window.location.href;try{const r=await k.post("/retrieveReferenceFields",{crmConnectionId:h.id,fieldId:n.id,originURL:p,viewerId:m});r.data?(E(r.data),j(n),console.log("our data: ",l),x(!1)):(console.error("Failed to retrieve CRM object details:",r.data.message),x(!1))}catch(r){console.error("Error retrieving CRM object details:",r),x(!1)}},z=n=>{f(n),w(!0)},d=n=>{const p=n.toLowerCase();if(f({name:n}),n!==""){const r=l.filter(D=>D.name.toLowerCase().includes(p));y(r)}else y(l)},F=()=>{w(!0)},s=async()=>{const n={name:N.name,api_name:N.apiName,type:N.type,salesforce_field:P,created_by:m};await k.post("/insertReferenceLevelOneField",n)&&(B(),w(!0),L(""),f({name:""}),j(null))};console.log("Selected Field:",N);const c=n=>{const p=[];let r=!0;for(let D=0;D<n.length;D++){r=!0;for(let O=0;O<o.referenceFieldLevelOne.length;O++)if(n[D].api_name===o.referenceFieldLevelOne[O].api_name&&n[D].name===o.referenceFieldLevelOne[O].name&&n[D].type===o.referenceFieldLevelOne[O].type){r=!1;break}r&&p.push(n[D])}return p},A=n=>async()=>{try{(await k.delete("/deleteReferenceLevelOneField",{data:{viewer_id:m,id:n.id},withCredentials:!0})).status===200?(H.success("Record deleted successfully"),i(r=>r.filter(D=>D.id!==n.id)),B()):H.error("Record not found")}catch(p){console.error("Error deleting record:",p),H.error("Internal Server Error")}},b=(n,p=0)=>n.map(r=>e.jsxs(G.Fragment,{children:[e.jsxs("tr",{className:`${p>0?"bg-gray-200":"bg-white"}`,onMouseEnter:()=>S(r.id),onMouseLeave:()=>S(null),children:[e.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-slate-600 text-sm font-bold cursor-pointer tracking-wider ${p>0?"pl-6":""}`,children:p===0&&r.type==="reference"?e.jsx(M,{className:"text-cyan-700 cursor-pointer",icon:se,onClick:()=>{q(r)}}):v===r.id&&p>0&&e.jsx(M,{className:"text-cyan-700 cursor-pointer",icon:ne,onClick:A(r)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-slate-600 text-sm font-bold cursor-pointer tracking-wider",children:r.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-slate-600 text-sm font-bold cursor-pointer tracking-wider",children:r.api_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-slate-600 text-sm font-bold cursor-pointer tracking-wider",children:r.type}),e.jsx("td",{className:"px-6  py-4 whitespace-nowrap text-slate-600 text-sm font-bold cursor-pointer tracking-wider",children:r.reference_level+"  "})]}),r.referenceFieldLevelOne&&r.referenceFieldLevelOne.length>0&&b(r.referenceFieldLevelOne,p+1),r.referenceFieldLevelTwo&&r.referenceFieldLevelTwo.length>0&&b(r.referenceFieldLevelTwo,p+2)]},r.id));return g?e.jsx("div",{children:e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-800 opacity-50"}),e.jsx("div",{className:"bg-transparent p-6 rounded-md z-50 w-auto",children:e.jsx(V,{visible:!0,height:"40",width:"40",color:"#075985",ariaLabel:"grid-loading",radius:"12.5",wrapperStyle:{},wrapperClass:"grid-wrapper"})})]})}):e.jsxs("div",{className:"",children:[e.jsx(de,{}),o&&e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 ",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-800 opacity-30"}),e.jsx("div",{className:"w-1/3 border-2 bg-white pt-4 relative rounded-lg ",children:e.jsxs("div",{className:" rounded-lg mb-4 ml-4 mr-4",children:[e.jsxs("div",{className:"text-lg font-medium m-2",children:["Add New Lookup field for ",o.name]}),e.jsxs("div",{className:"border b-2 border-gray-300 rounded-lg",children:[e.jsx("div",{className:"flex mx-2",children:e.jsx("input",{type:"text",className:"h-10 w-full focus:outline-none",placeholder:"Enter the value",value:N.name,onChange:n=>{d(n.target.value)},onClick:F})}),R&&e.jsx("div",{className:"relative w-full max-h-48 overflow-y-auto border-t border-gray-300 bg-white z-10 mt-1",children:e.jsx("table",{className:"relative w-[27rem] bg-white mx-2 mt-2",children:e.jsx("tbody",{className:"",children:c(l).map((n,p)=>e.jsx("tr",{onClick:()=>z(n),className:"cursor-pointer hover:bg-gray-200",children:e.jsx("td",{className:"p-2",children:n.name})},n.name))})})})]}),e.jsxs("div",{className:"flex justify-center my-2 mx-10 space-x-3 mt-4 transition-all duration-300 mt-22 max-[800px]:mt-15",children:[e.jsx("button",{className:"flex w-28 h-10 px-6 text-sm rounded-xl justify-center items-center border border-solid border-red-500 bg-red-300 hover:bg-red-400 text-red-800 hover:text-red-900",onClick:()=>{w(!0),j(null),f({name:""})},children:"Close"}),e.jsx("button",{className:"flex w-28 h-10 px-6 text-sm rounded-xl justify-center items-center border border-solid border-gray-400 bg-white hover:bg-gray-300 text-gray-800 hover:text-gray-900",onClick:s,disabled:N.name.length===0,children:"Create"})]})]})})]}),e.jsx("div",{className:"container overflow-auto my-2",children:e.jsx("div",{className:"table-wrapper overflow-auto h-[300px] 2xl:h-[450px] bg-gray-100 ",children:e.jsxs("table",{className:"bg-white rounded-xl border-2 overflow-auto w-full h-[100px] ",children:[e.jsx("thead",{className:"w-full",children:e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"sticky top-0 bg-gray-100 py-5 table-heading px-6 border-b text-left whitespace-nowrap text-xs font-medium text-sky-800 uppercase tracking-wide"}),e.jsx("th",{className:"sticky top-0 bg-gray-100 py-5 table-heading px-6 border-b text-left whitespace-nowrap text-xs font-medium text-sky-800 uppercase tracking-wide",children:"Name"}),e.jsx("th",{className:"sticky top-0 bg-gray-100 py-5 table-heading px-6 border-b text-left whitespace-nowrap text-xs font-medium text-sky-800 uppercase tracking-wide",children:"API Name"}),e.jsx("th",{className:"sticky top-0 bg-gray-100 py-5 table-heading px-6 border-b text-left whitespace-nowrap text-xs font-medium text-sky-800 uppercase tracking-wide",children:"Type"}),e.jsx("th",{className:"sticky top-0 bg-gray-100 py-5 table-heading px-6 border-b text-left whitespace-nowrap text-xs font-medium text-sky-800 uppercase tracking-wide",children:"Level"})]})}),e.jsx("tbody",{className:`bg-white divide-y divide-gray-200 ${t.length>=8?"h-72 overflow-y-scroll":"h-auto"}`,children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-4",children:"No data available"})}):b(t)})]})})})]})}function je(){const{objectDetails:t,refDetails:i,setRefDetails:h,viewer_id:E,setSelectedFieldId:l,selectedFieldId:m,connectionObjectLoading:u,setConnectionObjectLoading:o}=a.useContext(U),[j,C]=a.useState([]),[y,R]=a.useState(!1);_(),a.useEffect(()=>{const S=t?Object.keys(t).map(g=>({id:t[g].id,Name:t[g].name,api_name:t[g].api_name,relevant:t[g].relevant})):[];S.sort((g,x)=>x.relevant-g.relevant),C(S)},[t]);const w=["id","api_name","relevant"],v=["id","api_name","relevant"];if(y||u)return e.jsx("div",{className:"flex justify-center items-center h-96 mr-24  ",children:e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(V,{visible:!0,height:40,width:40,color:"#075985",ariaLabel:"grid-loading",radius:12.5})})});if(console.log("objectDetailsArray",j),i)return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("button",{className:"bg-white text-sky-800 px-4 py-2 rounded-2xl shadow-md mr-4 hover:bg-sky-800 hover:text-white transition duration-300 ease-in-out",onClick:()=>h(null),children:"Back"}),e.jsx("div",{children:e.jsx(ve,{})})]});if(t)return e.jsx(X,{data:j,columnsHeading:w,rowKeys:v,noCheckbox:!0})}function Ie(){var F;const{viewer_id:t,setSelectedConnections:i,selectedConnections:h,addConnectionsClicked:E,connectionDetails:l,setConnectionDetails:m,setObjectDetails:u,baseURL:o,showConnectionButtons:j,setShowConnectionButtons:C,connections:y,setConnections:R,connectionObjectLoading:w,setConnectionObjectLoading:v}=a.useContext(U),[S,g]=a.useState(!0),x=_(),[k,N]=a.useState(!1),f=W(s=>s.filter);a.useEffect(()=>{const s=new URLSearchParams(window.location.search),c=s.get("crmConnectionId");if(c){d(c);const A=window.location.href,b=new Promise(async(n,p)=>{try{if(!t||!c){console.error("viewer_id and crmConnectionId are required."),p("Viewer ID and connection details are required.");return}const r=`${o}/salesforce-authorisation`,D=new URL(r);D.searchParams.append("crm_connection_id",c),D.searchParams.append("viewer_id",t),D.searchParams.append("originURL",A);const O=D.toString().replace(o,""),Q=await x.get(O),T=await Q.data;if(!(Q.status>=200&&Q.status<300))throw new Error("Failed to authorize connection");T&&T.authUrl?(window.location.href=T.authUrl,n("Salesforce data synchronized successfully.")):(console.log("Not a valid JSON response"),n("Salesforce data synchronized successfully."))}catch(r){console.error("Error authorizing connection:",r.message),p("Error authorizing connection: "+r.message)}});I.promise(b,{loading:"Authorizing Salesforce connection...",success:n=>{s.delete("crmConnectionId");const p=window.location.pathname+"?"+s.toString();return window.history.replaceState({},"",p),`${n}`},error:n=>`Failed: ${n}`}),d()}},[]),a.useEffect(()=>{(async()=>{try{const c=await x.post("/view-all-crm-connections",{viewer_id:t});if(c.data.success){const A=c.data.connections.map(b=>({...b,"Created At":b.created_at||"N/A","Created By":b.created_by||"N/A","Updated By":b.updated_by||"N/A","Updated At":b.updated_at||"NA","Is Primary":b.is_primary}));R(A),g(!1)}else console.error("Failed to fetch connections:",c.data.message),g(!1)}catch(c){console.error("Error fetching connections:",c),g(!1)}})()},[t]);const P=(F=f==null?void 0:f.filterData)==null?void 0:F.map(s=>({...s,"Created At":s.created_at||"N/A","Created By":s.created_by||"N/A","Updated By":s.updated_by||"N/A","Updated At":s.updated_at||"NA","Is Primary":s.is_primary}));if(l)return console.log("Inside if"),e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs("div",{className:"",children:[j&&e.jsx(J,{}),e.jsx(we,{}),e.jsx(je,{})]})});const L=["name","crm","owner","Created By","Created At","Updated By","Updated At","active","Is Primary"],B=["name","crm","owner_name","created_by_name","created_at","updated_by_name","updated_at","active","is_primary"],q=s=>{if(f.filterApplied){if(s.length==P.length||(s==null?void 0:s.length)==0){i(s);return}}else if(s.length==y.length||(s==null?void 0:s.length)==0){i(s);return}if(h.findIndex(A=>A.id===s.id)===-1)i(A=>[...A,s]);else{const A=h.filter(b=>b.id!=s.id);i(A)}},z=()=>{N(s=>!s)},d=async s=>{if(C(!0),t&&s){try{const c=await x.post("/view-crm-connection",{viewer_id:t,connection_id:s});c.data.success?m(c.data.connection):console.error("Failed to retrieve CRM connection:",c.data.message)}catch(c){console.error("Error retrieving CRM connection:",c)}if(t&&s)try{v(!0);const c=await x.post("/view-all-crm-salesforce-objects",{viewer_id:t,crm_connection:s});c.data.success?u(c.data.salesforceObjects):console.error("Failed to retrieve CRM object details:",c.data.message),v(!1)}catch(c){console.error("Error retrieving CRM object details:",c)}}};return console.log("Data",y),console.log("Filter Data",P),e.jsxs("div",{className:"container mx-auto p-4 mt-6",children:[e.jsx(J,{onAction:z}),E&&e.jsx(ye,{}),e.jsx(X,{data:f.filterApplied?P:y,columnsHeading:L,loading:f.loading||S,rowKeys:B,OnChangeHandler:q,selectedItems:h,OnClickHandler:d})]})}export{Ie as default};
