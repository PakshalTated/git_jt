import{a1 as Oe,l as Ue,r as n,b as Ie,t as U,a as Pe,c as _e,a2 as Ee,j as s}from"./index-b9OYvAdP.js";import{u as v}from"./useQuery-DuDYO2MU.js";import{e as Ae,f as De,g as Te}from"./index-DSB5HKeL.js";import{L as $e}from"./index-DHI5Vo0j.js";const Fe="/assets/revspire-logo-BE2oW9hd.webp",Be=(r,c=window.location.href)=>new URLSearchParams(c.split("?")[1]).get(r),q=r=>{const c=document.cookie.match(new RegExp("(^| )"+r+"=([^;]+)"));return c?decodeURIComponent(c[2]):null},at=()=>{var M,Q;const{pitchId:r}=Oe(),c=Ue(),h=n.useRef(null),p=Ie(),[z,G]=n.useState([]),[H,K]=n.useState(""),[j,Y]=n.useState(""),[N,X]=n.useState([]),[Z,C]=n.useState(!1),[Me,I]=n.useState(null),[Qe,ee]=n.useState(118),P=n.useRef(null),[g,te]=n.useState({key:null,direction:"ascending"}),[_,We]=n.useState(new Map),[E,f]=U(["baseURL"]),[L,se]=n.useState([]),[A,ae]=n.useState(null),[i,ne]=n.useState(null),[re,D]=n.useState(1),[Ve,ce]=n.useState(null),S=["name","email"],{setMicrosoftClarityProjectId:oe,setRevspireClient:ie}=n.useContext(Pe);_e();const T=Ee(),[le,$]=U(["userData"]),[qe,F]=U(["revspireToken"]),B=((e,t=window.location.href)=>new URLSearchParams(t.split("?")[1]).get(e))("apiURL"),o=decodeURIComponent(B),R=window.location.origin,de=encodeURIComponent(B);n.useEffect(()=>{if(o){let e=[];try{e=typeof E.baseURL=="string"?JSON.parse(E.baseURL):[]}catch(a){console.error("Error parsing baseURL cookie:",a)}const t=e.find(a=>a.frontend===R);t?t.baseURL!==o&&(t.baseURL=o,f("baseURL",JSON.stringify(e),{path:"/",maxAge:2*60*60,secure:!0,SameSite:"None"})):(e.push({frontend:R,baseURL:o}),f("baseURL",JSON.stringify(e),{path:"/",maxAge:2*60*60,secure:!0,SameSite:"None"})),f("revspireClient",1,{path:"/",maxAge:2*60*60,secure:!0,sameSite:"None"})}},[o,f,R]);const ue=async()=>{var t;const e=await c.get(`${o}/retrieve-pitch-sections-and-contents/${r}`,{withCredentials:!0});if(e.data.success){const a=((t=e.data.pitch)==null?void 0:t.owner)||null;ne(a),G(e.data.pitchContacts||[])}return e.data},{data:l,isLoading:fe}=v(["fetchPitchData",r],ue,{refetchOnWindowFocus:!1,staleTime:1/0,refetchOnMount:!1,refetchOnReconnect:!1,enabled:!!o,onSuccess:e=>{if(e.pitchContacts){const t=e.pitchContacts.map(a=>a.contact_sfdc_id);se(t)}}}),me=async()=>{try{return(await c.post(`${o}/validatePublicPitchAccess`,{viewer_id:i,pitch_id:r},{withCredentials:!0})).data}catch(e){console.log("Error from cookie ",e.message)}};n.useEffect(()=>{(async()=>{var t;if((t=l==null?void 0:l.pitch)!=null&&t.public_access){const a=await me();$("userData",JSON.stringify(a.userData),{path:"/",secure:!0,sameSite:"strict",maxAge:7200}),F("revspireToken",a.access_token,{path:"/",secure:!0,sameSite:"strict",maxAge:7200})}})()},[l]),n.useEffect(()=>{i&&T.invalidateQueries("fetchContacts")},[i,T]),v(["fetchContacts",L],async()=>{C(!0),I(null);try{const e=window.location.href,a=`${new URL(e).origin}?isClientFlow=1`,d=await c.post(`${o}/getContactsByIds`,{viewerId:i,originURL:a,contactIds:L},{withCredentials:!0});X(d.data)}catch(e){I("An error occurred while fetching contacts."),console.error("Error fetching contacts:",e)}finally{C(!1)}},{enabled:!!i&&L.length>0,refetchOnWindowFocus:!1,staleTime:1/0,refetchOnMount:!1,refetchOnReconnect:!1}),n.useEffect(()=>{(async()=>{try{const a=new URLSearchParams(window.location.search).get("revspireClientContact"),d=Array.from(_.values());f("revspireClientContact",JSON.stringify(d),{path:"/",maxAge:7200,secure:!0,SameSite:"None"})}catch(t){console.error("Something went wrong!!",t)}finally{C(!1)}})()},[_,f]),n.useEffect(()=>{var a;const e=q("revspireClient"),t=q("userData");if(console.log("Pitch Login Revspire Client value",e),console.log("Pitch Login Revspire userdata cookie",t),e&&ie(e),e==="1"&&t)try{const x=(a=JSON.parse(t).user)==null?void 0:a.microsoft_clarity_project_id;console.log("Pitch Login Revspire project id",x),x&&(oe(x),function(y,W,w,V,ke,b,O){y[w]=y[w]||function(){(y[w].q=y[w].q||[]).push(arguments)},b=W.createElement(V),b.async=1,b.src="https://www.clarity.ms/tag/"+ke,O=W.getElementsByTagName(V)[0],O.parentNode.insertBefore(b,O)}(window,document,"clarity","script",x))}catch(d){console.error("Error parsing userData cookie:",d)}},[le]);const he=async()=>{try{const e=await c.post(`${o}/pitch-preview-content`,{viewerId:i,content_name:`${r}_background_login_image`},{responseType:"blob",withCredentials:!0}),t=URL.createObjectURL(e.data);return K(t),t}catch(e){return console.error("Error fetching login image:",e),""}},{data:He,isSuccess:Ke,isLoading:pe}=v(["fetchLoginImage",r],he,{enabled:!!i,refetchOnWindowFocus:!1,staleTime:1/0,refetchOnMount:!1,refetchOnReconnect:!1}),ge=async()=>{try{const e=await c.post(`${o}/pitch-preview-content`,{viewerId:i,content_name:`${r}_client_logo`},{responseType:"blob",withCredentials:!0}),t=URL.createObjectURL(e.data);return Y(t),t}catch(e){return console.error("Error fetching client logo:",e),""}},{data:Ye,isSuccess:Xe,isLoading:xe}=v(["fetchClientLogo",r],ge,{enabled:!!i,refetchOnWindowFocus:!1,staleTime:1/0,refetchOnMount:!1,refetchOnReconnect:!1});n.useEffect(()=>{P.current&&ee(P.current.offsetHeight)},[]);const ye=async e=>{try{const t=z.find(d=>d.contact_sfdc_id==e.Id);console.log(t),ae(t.id);const a=await c.post(`${o}/generateDSRLoginOtp`,{pitch_contact_id:t.id,viewer_id:i});console.log("OTP sent to selected contacts")}catch(t){console.error("Error generating OTP:",t)}},[u,J]=n.useState(new Array(4).fill("")),[k,we]=n.useState(!1),m=n.useRef([]),be=(e,t)=>{if(isNaN(e.value))return;const a=[...u];a[t]=e.value,J(a),e.nextSibling&&e.value!==""&&e.nextSibling.focus()},ve=(e,t)=>{if(e.key==="Backspace"){const a=[...u];a[t]="",J(a),m.current[t-1]&&m.current[t-1].focus()}else e.key==="ArrowRight"&&t<u.length-1?m.current[t+1].focus():e.key==="ArrowLeft"&&t>0&&m.current[t-1].focus()},je=async e=>{try{console.log(A),console.log(i),console.log(typeof e);const t=await c.post(`${o}/validateDSROtp`,{pitch_contact_id:A,viewer_id:i,otp:Number(e)},{headers:{"Content-Type":"application/json"}});return console.log("token"+t.data),$("userData",JSON.stringify(t.data.userData),{path:"/",secure:!0,sameSite:"strict",maxAge:7200}),F("revspireToken",t.data.login_otp_token,{path:"/",secure:!0,sameSite:"strict",maxAge:7200}),setTimeout(()=>{p(`/dsr/${r}?${de}`)},2e3),t.data}catch(t){throw console.error("Error validating OTP:",t),t}},Ne=async()=>{const e=u.join("");try{const t=await je(e);console.log("OTP validation successful:",t)}catch(t){console.error("OTP validation failed:",t)}},Ce=e=>{let t="ascending";g.key===e&&g.direction==="ascending"&&(t="descending"),te({key:e,direction:t})},Le=fe||pe||xe;n.useEffect(()=>{const e=u.every(t=>t!=="");console.log("otp valid ",k),we(e)},[u]);const Se=e=>{ce(e),D(2),ye(e)};if(Le)return s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("img",{src:Fe,alt:"",className:"w-[150px]"}),s.jsx($e,{className:"text-2xl text-neutral-500 animate-spin"})]})});const Re=()=>{switch(re){case 1:return s.jsx("div",{className:"relative w-full flex justify-center lg:justify-start items-center h-full lg:ml-10",children:l.pitch.public_access?s.jsx(Je,{navigate:p,clientImageUrl:j,pitchId:r}):s.jsx("div",{className:"bg-white max-w-[400px] w-full p-4 h-[450px]  rounded-lg border border-neutral-200 overflow-hidden shadow-md",children:s.jsxs("div",{children:[s.jsx("img",{src:j,alt:"Company Logo",className:"mx-auto mb-2 h-16 w-auto rounded-lg"}),s.jsx("div",{children:s.jsx("h2",{className:" font-semibold text-gray-600 text-center mb-2",children:"Select a Contact to Generate OTP"})}),s.jsx("div",{className:"overflow-x-auto h-80 border border-gray-200 rounded-lg shadow-sm",children:s.jsxs("table",{ref:h,className:"min-w-full divide-y divide-gray-200 rounded-lg",children:[s.jsx("thead",{className:"bg-gray-50 sticky top-0 border-b",children:s.jsx("tr",{children:S.map((e,t)=>s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>Ce(e.toLowerCase()),children:s.jsxs("div",{className:"flex items-center",children:[e,s.jsx("span",{className:"ml-2",children:g.key===e.toLowerCase()?g.direction==="ascending"?s.jsx(Ae,{className:"text-blue-500"}):s.jsx(De,{className:"text-blue-500"}):s.jsx(Te,{className:"text-gray-400"})})]})},t))})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Z?[...Array(3)].map((e,t)=>s.jsx("tr",{children:s.jsx("td",{colSpan:S.length,className:"px-6 py-4",children:s.jsx("div",{className:"animate-pulse flex space-x-4",children:s.jsxs("div",{className:"flex-1 space-y-4 py-1",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})})})},t)):N.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:S.length,className:"px-6 py-4 text-center",children:s.jsx("div",{className:"flex flex-col items-center text-gray-500",children:s.jsx("div",{children:"Empty"})})})}):Array.isArray(N)&&N.map(e=>s.jsxs("tr",{className:"hover:bg-cyan-50 transition-colors cursor-pointer }",onClick:()=>Se(e),children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.jsx("span",{children:e.Name})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.Email})]},e.Id))})]})})]})})});case 2:return s.jsx("div",{className:"relative w-full flex justify-center lg:justify-start items-center h-full lg:ml-10",children:s.jsxs("div",{className:"bg-white max-w-[400px] w-full p-4 h-[450px]  rounded-lg border border-neutral-200 overflow-hidden shadow-md",children:[s.jsxs("div",{className:"w-full flex flex-col items-center",children:[s.jsx("img",{src:j,alt:"Company Logo",className:"mx-auto mb-4 h-10 w-auto"}),s.jsx("div",{className:"overflow-x-auto h-72 border border-neutral-300 rounded-lg overflow-y-auto w-full",children:s.jsxs("div",{className:"flex flex-col items-center justify-center mt-10 space-y-6 px-4 md:px-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"OTP Input"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Enter your one-time password"}),s.jsx("div",{className:"flex space-x-2 justify-center",children:u.map((e,t)=>s.jsx("input",{type:"text",maxLength:"1",value:e,onChange:a=>be(a.target,t),onKeyDown:a=>ve(a,t),ref:a=>m.current[t]=a,className:"size-10 text-center border border-neutral-300 rounded-lg shadow focus:outline-none focus:border-cyan-400  text-neutral-700"},t))})]})})]}),s.jsxs("div",{className:"flex justify-between mt-4",children:[s.jsx("button",{className:"flex text-base border border-neutral-300 py-1 w-[87px] px-4 bg-gradient-to-b from-neutral-100 to-neutral-200 rounded-lg font-medium items-center gap-2 text-neutral-800 justify-center hover:to-neutral-100 transition-all active:scale-95 disabled:opacity-90 ",onClick:()=>{D(1)},children:"Back"}),s.jsx("button",{disabled:!k,className:`flex text-base border py-1 w-[87px] px-4 bg-gradient-to-b from-cyan-700 to-cyan-900 rounded-lg font-medium items-center gap-2 text-neutral-100 justify-center hover:to-cyan-950 transition-all active:scale-95 disabled:opacity-90 ${k?"":"cursor-not-allowed"}`,onClick:Ne,children:"Submit"})]})]})});default:return null}};return s.jsxs("div",{className:"min-w-screen h-screen relative",children:[s.jsxs("div",{className:"absolute inset-0 z-0",children:[s.jsx("img",{src:H,alt:"Company Logo",className:"object-cover w-full h-full"}),s.jsx("div",{className:"absolute inset-0 bg-black opacity-20"})]}),s.jsxs("div",{className:"relative z-10 w-full h-full flex",children:[s.jsx("div",{className:"w-full flex justify-center items-center h-full",children:Re()}),s.jsx("div",{className:"bg-white hidden lg:block h-fit p-6 rounded-lg absolute right-10 top-10",children:s.jsxs("div",{className:"flex flex-col gap-4 lg:max-w-[500px] xl:max-w-[600px] w-full ",children:[s.jsx("h1",{className:"text-left lg:text-3xl xl:text-4xl font-fraunces text-cyan-600 line-clamp-3",children:(M=l==null?void 0:l.pitch)==null?void 0:M.headline}),s.jsx("p",{className:"text-left lg:text-xl xl:text-2xl text-neutral-700 line-clamp-4",children:(Q=l==null?void 0:l.pitch)==null?void 0:Q.title})]})})]})]})},Je=({clientImageUrl:r,pitchId:c,navigate:h})=>s.jsx("div",{className:"bg-white max-w-[400px] w-full p-4 h-[450px]  rounded-lg border border-neutral-200",children:s.jsxs("div",{className:"flex flex-col w-full h-full items-center justify-between",children:[s.jsxs("div",{className:"flex w-full gap-4 flex-col",children:[s.jsx("img",{src:r,alt:"Company Logo",className:"mx-auto h-16 rounded-xl object-cover w-auto"}),s.jsx("div",{className:"text-3xl mt-3 text-center font-extrabold text-transparent bg-clip-text bg-gradient-to-b from-neutral-600 to-neutral-800",children:"Welcome to Your Digital Sales Room"})]}),s.jsx("div",{className:"mb-5",children:s.jsx("button",{onClick:()=>{const p=encodeURIComponent(Be("apiURL"));h(`/dsr/${c}?apiURL=${p}`)},className:"flex text-xl border py-2 px-6 bg-gradient-to-b from-cyan-700 to-cyan-900 rounded-xl font-semibold items-center gap-2 text-neutral-100 justify-center hover:to-cyan-950 transition-all active:scale-95",children:"Continue"})})]})});export{at as default};
