import{t as L,r as s,a as T,b as F,u as _,l as j,e as K,am as R,j as w,an as U,ao as O,D as V}from"./index-b9OYvAdP.js";function J(){const[N,u,k]=L(["GoogleDirveAccessToken","googleClientId"]),b="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.readonly",{setDriveSelection:h,viewer_id:a,baseURL:C}=s.useContext(T),S=F(),g=_(),p=j();K(e=>e.contents.breadcrumbs);const[B,I]=s.useState(null),[r,v]=s.useState(!1),[l,A]=s.useState(!1),[D,y]=s.useState(""),[d,E]=s.useState(""),[f,x]=s.useState("");s.useEffect(()=>{p.post("/google-credentials",{viewer_id:a}).then(e=>{e.data.message==="Google credentials generated successfully"&&(y(e.data.googleApiKey),E(e.data.googleClientId))}).catch(e=>{console.error("Failed to fetch namespace",e)})},[a]),s.useEffect(()=>{if(d){const e=()=>{window.gapi.load("picker",o)},o=()=>{v(!0)},c=()=>{const n=window.google.accounts.oauth2.initTokenClient({client_id:d,scope:b,callback:""});I(n),A(!0)};window.gapi_onload=e;const t=document.createElement("script");t.src="https://apis.google.com/js/api.js?onload=gapi_onload",document.body.appendChild(t);const i=document.createElement("script");i.src="https://accounts.google.com/gsi/client",i.async=!0,i.defer=!0,i.onload=c,document.body.appendChild(i)}},[d]);const P=e=>{if(r&&l&&e){const o=new window.google.picker.DocsView(window.google.picker.ViewId.DOCS).setIncludeFolders(!0).setSelectFolderEnabled(!0);new window.google.picker.PickerBuilder().enableFeature(window.google.picker.Feature.MULTISELECT_ENABLED).setOAuthToken(e).addView(o).setDeveloperKey(D).setCallback(t=>G(t,e)).build().setVisible(!0)}},G=async(e,o)=>{if(e.action===window.google.picker.Action.PICKED){const c=e.docs[0].id;h(!1),O.promise(p.post("/googledrive-upload",{fileID:c,created_by:a,accessToken:o,folder_id:f}),{loading:"Uploading file...",success:"Content Added Successfully!",error:"Failed to Add Content"}).then(()=>g(V({viewer_id:a,folder_id:f,baseURL:C}))).catch(t=>{console.error("Google Drive upload error:",t)})}};return s.useEffect(()=>{var n;const e=new URLSearchParams(window.location.search),o=e.get("accessToken"),c=e.get("breadcrumbState");let t=[];if(c)try{t=JSON.parse(decodeURIComponent(c))}catch(m){console.error("Failed to parse breadcrumb state:",m)}const i=(n=t[t.length-1])==null?void 0:n.id;x(i),g(R(t)),o&&(u("GoogleDirveAccessToken",o,{path:"/",secure:!0,sameSite:"Lax",maxAge:3599}),o&&(console.log("for opening Picker",o),P(o))),r&&l&&S("/"),k("googleClientId",{path:"/",domain:".revspire.net",secure:!0,sameSite:"Lax"})},[u,r,l]),w.jsx("div",{children:w.jsx(U,{size:100})})}export{J as default};
