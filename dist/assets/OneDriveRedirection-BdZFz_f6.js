import{r as c,a as S,b,u as j,l as w,t as F,j as s,am as N}from"./index-b9OYvAdP.js";import"./module-C6tlsdyI.js";function E(){const[h,p]=c.useState(!0),{setOneDrivePickerOpen:f,setFolderPath:m,setFolder_id:g,viewer_id:u,baseURL:T}=c.useContext(S),x=b(),v=j(),k=w(),[a,i,t]=F(["OneDriveAccessToken","OneDriveData","accessToken","scope","nameSpace","folderPath","refreshToken"]);return c.useEffect(()=>{(async()=>{try{const r=a.accessToken,l=a.refreshToken,D=a.scope,n=a.nameSpace,e=a.folderPath;if(console.log("Encoded folder path (raw):",e),r&&D&&n&&e&&l){let o;if(Array.isArray(e)&&e.length>0){console.log("Detected encodedFolderPath as array of objects:",e);const d=e[e.length-1];console.log("Extracted Last Flder: ",d),o=d.id,console.log("Extracted Folder ID:",o)}else console.warn("encodedFolderPath is not an array or is empty:",e);o?(g(o),m(o),v(N(e))):console.error("Folder ID could not be determined.");const y={nameSpace:n,folderPath:JSON.stringify(e),folderID:o};i("OneDriveAccessToken",r,{path:"/",maxAge:3600,SameSite:"None"}),i("OneDriveData",JSON.stringify(y),{path:"/",maxAge:3600,SameSite:"None"}),await k.post("/onedrive-file-sync",{viewer_id:u,refresh_token:l,access_token:r,namespace:n},{withCredentials:!0}),f(!0),x("/")}else console.warn("Missing required parameters in the URL.")}catch(r){console.error("Error handling redirect:",r)}finally{t("accessToken",{path:"/"}),t("scope",{path:"/"}),t("nameSpace",{path:"/"}),t("folderPath",{path:"/"}),t("refreshToken",{path:"/"}),p(!1)}})()},[]),s.jsx("div",{className:"flex justify-center items-center h-screen",children:h?s.jsx("div",{className:`mini-logo ${active?"logoActive":""}`,children:s.jsx("div",{className:"app-container h-[500px] w-[900px]",children:s.jsx("div",{className:"loader-container h-full bg-cover w-full",children:s.jsx("img",{className:"logos h-full w-full bg-cover  bg-white p-2",src:logo,alt:"Logo"})})})}):s.jsx("div",{id:"pickedFiles"})})}export{E as default};
